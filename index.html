<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notion API - Documentación Interactiva</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: #fff;
            padding: 30px 20px;
            margin-bottom: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        h1 {
            color: #000;
            font-size: 2em;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #666;
            font-size: 1.1em;
        }

        .api-section {
            background: #fff;
            margin-bottom: 30px;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .api-section h2 {
            color: #000;
            font-size: 1.5em;
            margin-bottom: 10px;
            border-bottom: 2px solid #000;
            padding-bottom: 10px;
        }

        .api-section p {
            color: #666;
            margin-bottom: 20px;
        }

        .endpoint {
            background: #f8f8f8;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 15px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }

        .method {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 3px;
            font-weight: bold;
            margin-right: 10px;
        }

        .method.get {
            background: #61affe;
            color: #fff;
        }

        .method.post {
            background: #49cc90;
            color: #fff;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #333;
        }

        input, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1em;
            font-family: 'Courier New', monospace;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #000;
        }

        button {
            background: #000;
            color: #fff;
            padding: 12px 24px;
            border: none;
            border-radius: 4px;
            font-size: 1em;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.3s;
        }

        button:hover {
            background: #333;
        }

        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .result-container {
            margin-top: 20px;
            display: none;
        }

        .result-container.show {
            display: block;
        }

        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .result-header h3 {
            color: #333;
            font-size: 1.2em;
        }

        .status-badge {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: 600;
        }

        .status-badge.success {
            background: #d4edda;
            color: #155724;
        }

        .status-badge.error {
            background: #f8d7da;
            color: #721c24;
        }

        .result-content {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 20px;
            border-radius: 4px;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            line-height: 1.5;
            max-height: 500px;
            overflow-y: auto;
        }

        .json-viewer {
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            line-height: 1.6;
        }

        .json-key {
            color: #9cdcfe;
            font-weight: bold;
        }

        .json-string {
            color: #ce9178;
        }

        .json-number {
            color: #b5cea8;
        }

        .json-boolean {
            color: #569cd6;
        }

        .json-null {
            color: #808080;
            font-style: italic;
        }

        .json-object {
            margin-left: 20px;
        }

        .json-array {
            margin-left: 20px;
        }

        .json-toggle {
            cursor: pointer;
            user-select: none;
            color: #4ec9b0;
            margin-right: 5px;
        }

        .json-toggle:hover {
            color: #6ec9b0;
        }

        .json-collapsed {
            display: none;
        }

        .json-bracket {
            color: #d4d4d4;
        }

        .json-comma {
            color: #d4d4d4;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #000;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 4px;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Notion API</h1>
            <p class="subtitle">Documentación Interactiva - Prueba las funciones de la API de Notion</p>
        </header>

        <!-- Search Section -->
        <div class="api-section">
            <h2>1. Search</h2>
            <p>Busca páginas o bases de datos en tu workspace de Notion.</p>
            <div class="endpoint">
                <span class="method post">POST</span> /api/search
            </div>
            <div class="form-group">
                <label for="search-type">Tipo de búsqueda:</label>
                <select id="search-type">
                    <option value="page">Page</option>
                    <option value="data_source">Data Source</option>
                </select>
            </div>
            <button onclick="executeSearch()">Ejecutar Búsqueda</button>
            <div id="search-result" class="result-container">
                <div class="result-header">
                    <h3>Resultado</h3>
                    <span id="search-status" class="status-badge"></span>
                </div>
                <div id="search-content" class="result-content"></div>
            </div>
        </div>

        <!-- Get Page Section -->
        <div class="api-section">
            <h2>2. Get Page</h2>
            <p>Obtiene los detalles de una página específica por su ID.</p>
            <div class="endpoint">
                <span class="method get">GET</span> /api/pages/:id
            </div>
            <div class="form-group">
                <label for="page-id">Page ID:</label>
                <input type="text" id="page-id" placeholder="59833787-2cf9-4fdf-8782-e53db20768a5">
            </div>
            <button onclick="executeGetPage()">Obtener Página</button>
            <div id="page-result" class="result-container">
                <div class="result-header">
                    <h3>Resultado</h3>
                    <span id="page-status" class="status-badge"></span>
                </div>
                <div id="page-content" class="result-content"></div>
            </div>
        </div>

        <!-- Get Block Section -->
        <div class="api-section">
            <h2>3. Get Block</h2>
            <p>Obtiene los detalles de un bloque específico por su ID.</p>
            <div class="endpoint">
                <span class="method get">GET</span> /api/blocks/:id
            </div>
            <div class="form-group">
                <label for="block-id">Block ID:</label>
                <input type="text" id="block-id" placeholder="insert-a-block-id-here">
            </div>
            <button onclick="executeGetBlock()">Obtener Bloque</button>
            <div id="block-result" class="result-container">
                <div class="result-header">
                    <h3>Resultado</h3>
                    <span id="block-status" class="status-badge"></span>
                </div>
                <div id="block-content" class="result-content"></div>
            </div>
        </div>

        <!-- Get Database Section -->
        <div class="api-section">
            <h2>4. Get Database</h2>
            <p>Obtiene los detalles de una base de datos específica por su ID.</p>
            <div class="endpoint">
                <span class="method get">GET</span> /api/databases/:id
            </div>
            <div class="form-group">
                <label for="database-id">Database ID:</label>
                <input type="text" id="database-id" placeholder="database-id-here">
            </div>
            <button onclick="executeGetDatabase()">Obtener Base de Datos</button>
            <div id="database-result" class="result-container">
                <div class="result-header">
                    <h3>Resultado</h3>
                    <span id="database-status" class="status-badge"></span>
                </div>
                <div id="database-content" class="result-content"></div>
            </div>
        </div>
    </div>

    <script>
        // Helper function to format JSON with beautiful HTML rendering
        function formatJSON(obj, depth = 0) {
            if (obj === null) {
                return '<span class="json-null">null</span>';
            }
            
            if (obj === undefined) {
                return '<span class="json-null">undefined</span>';
            }
            
            const type = typeof obj;
            
            if (type === 'string') {
                // Truncate very long strings
                const displayStr = obj.length > 200 ? obj.substring(0, 200) + '...' : obj;
                return `<span class="json-string">"${escapeHtml(displayStr)}"</span>`;
            }
            
            if (type === 'number') {
                return `<span class="json-number">${obj}</span>`;
            }
            
            if (type === 'boolean') {
                return `<span class="json-boolean">${obj}</span>`;
            }
            
            if (Array.isArray(obj)) {
                if (obj.length === 0) {
                    return '<span class="json-bracket">[]</span>';
                }
                
                const id = 'array-' + Math.random().toString(36).substr(2, 9);
                const shouldCollapse = obj.length > 5 || depth > 2;
                let html = '<span class="json-toggle" onclick="toggleCollapse(\'' + id + '\')">' + (shouldCollapse ? '▶' : '▼') + '</span>';
                html += '<span class="json-bracket">[</span>';
                html += '<span style="color: #808080; font-size: 0.9em;"> ' + obj.length + ' items</span>';
                html += '<div class="json-array" id="' + id + '" style="display: ' + (shouldCollapse ? 'none' : 'block') + ';">';
                
                obj.forEach((item, index) => {
                    html += '<div style="margin-left: 20px;">';
                    html += formatJSON(item, depth + 1);
                    if (index < obj.length - 1) {
                        html += '<span class="json-comma">,</span>';
                    }
                    html += '</div>';
                });
                
                html += '</div>';
                html += '<span class="json-bracket">]</span>';
                return html;
            }
            
            if (type === 'object') {
                const keys = Object.keys(obj);
                if (keys.length === 0) {
                    return '<span class="json-bracket">{}</span>';
                }
                
                const id = 'obj-' + Math.random().toString(36).substr(2, 9);
                const shouldCollapse = keys.length > 10 || depth > 2;
                let html = '<span class="json-toggle" onclick="toggleCollapse(\'' + id + '\')">' + (shouldCollapse ? '▶' : '▼') + '</span>';
                html += '<span class="json-bracket">{</span>';
                html += '<div class="json-object" id="' + id + '" style="display: ' + (shouldCollapse ? 'none' : 'block') + ';">';
                
                keys.forEach((key, index) => {
                    html += '<div style="margin-left: 20px;">';
                    html += '<span class="json-key">"' + escapeHtml(key) + '"</span>: ';
                    html += formatJSON(obj[key], depth + 1);
                    if (index < keys.length - 1) {
                        html += '<span class="json-comma">,</span>';
                    }
                    html += '</div>';
                });
                
                html += '</div>';
                html += '<span class="json-bracket">}</span>';
                return html;
            }
            
            return escapeHtml(String(obj));
        }
        
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        function toggleCollapse(id) {
            const element = document.getElementById(id);
            const toggle = element.previousElementSibling;
            
            if (element.style.display === 'none') {
                element.style.display = 'block';
                toggle.textContent = '▼';
            } else {
                element.style.display = 'none';
                toggle.textContent = '▶';
            }
        }

        // Helper function to show result
        function showResult(resultId, statusId, contentId, data, isError = false) {
            const resultContainer = document.getElementById(resultId);
            const statusBadge = document.getElementById(statusId);
            const content = document.getElementById(contentId);

            resultContainer.classList.add('show');
            
            if (isError) {
                statusBadge.textContent = 'Error';
                statusBadge.className = 'status-badge error';
                content.innerHTML = '<div class="json-viewer">' + formatJSON(data) + '</div>';
            } else {
                statusBadge.textContent = 'Success';
                statusBadge.className = 'status-badge success';
                content.innerHTML = '<div class="json-viewer">' + formatJSON(data) + '</div>';
            }
        }

        // Search function
        async function executeSearch() {
            const type = document.getElementById('search-type').value;
            const button = event.target;
            const originalText = button.textContent;
            
            button.disabled = true;
            button.innerHTML = originalText + '<span class="loading"></span>';

            try {
                const response = await fetch('/api/search', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ value: type })
                });

                const data = await response.json();
                
                if (response.ok) {
                    showResult('search-result', 'search-status', 'search-content', data);
                } else {
                    showResult('search-result', 'search-status', 'search-content', data, true);
                }
            } catch (error) {
                showResult('search-result', 'search-status', 'search-content', { error: error.message }, true);
            } finally {
                button.disabled = false;
                button.textContent = originalText;
            }
        }

        // Get Page function
        async function executeGetPage() {
            const pageId = document.getElementById('page-id').value.trim();
            const button = event.target;
            const originalText = button.textContent;

            if (!pageId) {
                alert('Por favor ingresa un Page ID');
                return;
            }

            button.disabled = true;
            button.innerHTML = originalText + '<span class="loading"></span>';

            try {
                const response = await fetch(`/api/pages/${pageId}`);
                const data = await response.json();
                
                if (response.ok) {
                    showResult('page-result', 'page-status', 'page-content', data);
                } else {
                    showResult('page-result', 'page-status', 'page-content', data, true);
                }
            } catch (error) {
                showResult('page-result', 'page-status', 'page-content', { error: error.message }, true);
            } finally {
                button.disabled = false;
                button.textContent = originalText;
            }
        }

        // Get Block function
        async function executeGetBlock() {
            const blockId = document.getElementById('block-id').value.trim();
            const button = event.target;
            const originalText = button.textContent;

            if (!blockId) {
                alert('Por favor ingresa un Block ID');
                return;
            }

            button.disabled = true;
            button.innerHTML = originalText + '<span class="loading"></span>';

            try {
                const response = await fetch(`/api/blocks/${blockId}`);
                const data = await response.json();
                
                if (response.ok) {
                    showResult('block-result', 'block-status', 'block-content', data);
                } else {
                    showResult('block-result', 'block-status', 'block-content', data, true);
                }
            } catch (error) {
                showResult('block-result', 'block-status', 'block-content', { error: error.message }, true);
            } finally {
                button.disabled = false;
                button.textContent = originalText;
            }
        }

        // Get Database function
        async function executeGetDatabase() {
            const databaseId = document.getElementById('database-id').value.trim();
            const button = event.target;
            const originalText = button.textContent;

            if (!databaseId) {
                alert('Por favor ingresa un Database ID');
                return;
            }

            button.disabled = true;
            button.innerHTML = originalText + '<span class="loading"></span>';

            try {
                const response = await fetch(`/api/databases/${databaseId}`);
                const data = await response.json();
                
                if (response.ok) {
                    showResult('database-result', 'database-status', 'database-content', data);
                } else {
                    showResult('database-result', 'database-status', 'database-content', data, true);
                }
            } catch (error) {
                showResult('database-result', 'database-status', 'database-content', { error: error.message }, true);
            } finally {
                button.disabled = false;
                button.textContent = originalText;
            }
        }
    </script>
</body>
</html>

